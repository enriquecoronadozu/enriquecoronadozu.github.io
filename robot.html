<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>3-DOF Robot Arm — Pick & Place (same trajectory)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      color-scheme: dark;
    }

    body {
      margin: 0;
      background: #0b0f17;
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 24px;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    svg {
      width: min(960px, 96vw);
      height: auto;
      background: #0e1320;
      border: 1px solid rgba(255, 255, 255, .08);
      border-radius: 14px;
      box-shadow: 0 14px 48px rgba(0, 0, 0, .35);
    }

    .grid line {
      stroke: rgba(255, 255, 255, .06);
      stroke-width: 1;
    }

    .stageFrame {
      fill: none;
      stroke: rgba(255, 255, 255, .08);
      stroke-width: 1;
    }

    .link {
      fill: url(#linkGrad);
    }

    .joint {
      fill: #0f111a;
      stroke: #3ce8f2;
      stroke-width: 2;
    }

    .ee {
      fill: #0f111a;
      stroke: #8d8bff;
      stroke-width: 2;
    }

    .gripBase {
      fill: #151a28;
      stroke: #6ea8ff;
      stroke-width: 1.5;
      opacity: .9;
    }

    .jaw {
      fill: #1b2a55;
      stroke: #9cd2ff;
      stroke-width: 1.5;
    }

    .jawFixed {
      fill: #26376b;
      stroke: #9cd2ff;
      stroke-width: 1.5;
      opacity: .9;
    }

    .pad {
      fill: #13223a;
      stroke: #214a8a;
      stroke-width: 1;
      opacity: .85;
    }

    .cube {
      fill: #2fe3ff;
      stroke: #0bbcd1;
      stroke-width: 2;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
</head>

<body>
  <svg viewBox="0 0 920 580" aria-label="3-DOF robot arm">
    <defs>
      <linearGradient id="linkGrad" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0%" stop-color="#23d5e6" />
        <stop offset="100%" stop-color="#2d3c9a" />
      </linearGradient>
      <clipPath id="stageClip" clipPathUnits="userSpaceOnUse">
        <rect x="20" y="20" width="880" height="540" rx="14" ry="14"></rect>
      </clipPath>
    </defs>

    <rect class="stageFrame" x="20" y="20" width="880" height="540" rx="14" ry="14"></rect>

    <g clip-path="url(#stageClip)">
      <!-- grid -->
      <g class="grid">
        <g>
          <line x1="80" y1="20" x2="80" y2="560" />
          <line x1="180" y1="20" x2="180" y2="560" />
          <line x1="280" y1="20" x2="280" y2="560" />
          <line x1="380" y1="20" x2="380" y2="560" />
          <line x1="480" y1="20" x2="480" y2="560" />
          <line x1="580" y1="20" x2="580" y2="560" />
          <line x1="680" y1="20" x2="680" y2="560" />
          <line x1="780" y1="20" x2="780" y2="560" />
        </g>
        <g>
          <line x1="20" y1="80" x2="900" y2="80" />
          <line x1="20" y1="160" x2="900" y2="160" />
          <line x1="20" y1="240" x2="900" y2="240" />
          <line x1="20" y1="320" x2="900" y2="320" />
          <line x1="20" y1="400" x2="900" y2="400" />
          <line x1="20" y1="480" x2="900" y2="480" />
        </g>
      </g>

      <!-- pads + cube (world space) -->
      <rect class="pad" x="465" y="420" width="60" height="12" rx="3"></rect>
      <rect class="pad" x="360" y="280" width="60" height="12" rx="3"></rect>
      <rect id="cube" class="cube" x="576" y="388" width="28" height="28" rx="3"></rect>

      <!-- ROBOT -->
      <g id="robot" transform="translate(240,380) scale(0.95)">
        <rect x="-56" y="18" width="112" height="22" rx="6" fill="#1b2233"></rect>
        <circle cx="0" cy="0" r="14" class="joint"></circle>

        <!-- Joint 1 -->
        <g id="j1" transform="rotate(0)">
          <rect x="0" y="-12" width="180" height="24" rx="12" class="link"></rect>
          <circle cx="0" cy="0" r="10" class="joint"></circle>

          <!-- end of L1 -->
          <g transform="translate(180,0)">
            <!-- Joint 2 -->
            <g id="j2" transform="rotate(0)">
              <rect x="0" y="-10" width="140" height="20" rx="10" class="link"></rect>
              <circle cx="0" cy="0" r="9" class="joint"></circle>

              <!-- end of L2 -->
              <g transform="translate(140,0)">
                <!-- Joint 3 -->
                <g id="j3" transform="rotate(0)">
                  <rect x="0" y="-9" width="110" height="18" rx="9" class="link"></rect>
                  <circle cx="0" cy="0" r="8" class="joint"></circle>

                  <!-- End-effector: PARALLEL JAW GRIPPER rotated 90° -->
                  <g id="eeT" transform="translate(110,0)">
                    <circle cx="0" cy="0" r="9" class="ee"></circle>

                    <!-- YOUR exact inner structure -->
                    <g id="eeT" transform="translate(30,0)">
                      <g id="j3" transform="rotate(90)">
                        <!-- gripper body -->
                        <rect class="gripBase" x="-14" y="20" width="28" height="24" rx="4"></rect>

                        <!-- fixed bar (optional) -->
                        <g id="jawFixed" transform="translate(0,18)">
                          <rect class="jawFixed" x="-20" y="-3" width="40" height="6" rx="2"></rect>
                        </g>

                        <!-- PAYLOAD ANCHOR (cube attaches here when grasped) -->
                        <g id="payloadAnchor"></g>

                        <!-- moving jaws -->
                        <g id="jawL" transform="translate(-14,0)">
                          <rect class="jaw" x="-3" y="-20" width="6" height="40" rx="2"></rect>
                        </g>
                        <g id="jawR" transform="translate(14,0)">
                          <rect class="jaw" x="-3" y="-20" width="6" height="40" rx="2"></rect>
                        </g>
                      </g>
                    </g>
                    <!-- end of gripper -->
                  </g>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
    </g>
  </svg>

  <script>
    const ease = 'easeInOutCubic';

    // Select outer joints (note duplicate #j3 exists; we need the FIRST one = wrist)
    const j1 = document.querySelector('#j1');
    const j2 = document.querySelector('#j2');
    const j3 = document.querySelectorAll('#j3')[0];

    const jawL = document.querySelector('#jawL');
    const jawR = document.querySelector('#jawR');
    const cube = document.querySelector('#cube');

    // Stage (world) group and anchor (inside gripper)
    const stage = document.querySelector('g[clip-path]');   // world layer
    const anchor = document.querySelector('#payloadAnchor'); // child of gripper

    // Jaw gaps (gripper-local X)
    const OPEN = 14;
    const CLOSED = 5;

    // Poses (deg) — tune to align with pads visually
    const homePose = [-60, 20, 90];
    const pickPose = [-45, 45, 90];
    const liftPose = [-45, 45, 90];
    const placePose = [-65, 65, 90];

    // Cube world positions
    const pickXY = { x: 480, y: 388 };
    const placeXY = { x: 376, y: 248 };
    cube.setAttribute('x', pickXY.x);
    cube.setAttribute('y', pickXY.y);

    // Reparent helpers
    function attachCube() {
      // move cube inside gripper; center it between jaws (28x28 cube => -14,-14 offset)
      if (cube.parentNode !== anchor) {
        cube.setAttribute('x', -14);
        cube.setAttribute('y', -14);
        anchor.appendChild(cube);
      }
    }
    function detachCube() {
      // put cube back into world at the place pad
      if (cube.parentNode === anchor) {
        stage.appendChild(cube);
        cube.setAttribute('x', placeXY.x);
        cube.setAttribute('y', placeXY.y);
      }
    }

    const tMove = 1200;
    const tGrip = 500;
    const tLift = 600;
    const tCarry = 1400;
    const dwell = 250;

    const tl = anime.timeline({ autoplay: true, loop: true });

    // Home, open
    tl.add({ targets: j1, rotate: homePose[0], duration: 0 })
      .add({ targets: j2, rotate: homePose[1], duration: 0 }, 0)
      .add({ targets: j3, rotate: homePose[2], duration: 0 }, 0)
      .add({ targets: jawL, translateX: -OPEN, duration: 0 }, 0)
      .add({ targets: jawR, translateX: OPEN, duration: 0 }, 0)
      .add({ duration: 100 });


    // Move to pick
    tl.add({ targets: j1, rotate: pickPose[0], duration: tMove, easing: ease }, )
      .add({ targets: j2, rotate: pickPose[1], duration: tMove, easing: ease }, `-=${tMove}`)
      .add({ targets: j3, rotate: pickPose[2], duration: tMove, easing: ease }, `-=${tMove}`)
      .add({ duration: 100 });

    // Return home
    tl.add({ targets: j1, rotate: homePose[0], duration: tMove, easing: ease })
      .add({ targets: j2, rotate: homePose[1], duration: tMove, easing: ease }, `-=${tMove}`)
      .add({ targets: j3, rotate: homePose[2], duration: tMove, easing: ease }, `-=${tMove}`)
      .add({ duration: 600, endDelay: 250  });
  </script>
</body>

</html>