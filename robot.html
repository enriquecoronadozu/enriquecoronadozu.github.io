<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>3-DOF Robot Arm — Pick at “pick”, Place at “lift”</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      color-scheme: dark;
    }

    body {
      margin: 0;
      background: #0b0f17;
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 24px;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    svg {
      width: min(960px, 96vw);
      height: auto;
      background: #0e1320;
      border: 1px solid rgba(255, 255, 255, .08);
      border-radius: 14px;
      box-shadow: 0 14px 48px rgba(0, 0, 0, .35);
    }

    .grid line {
      stroke: rgba(255, 255, 255, .06);
      stroke-width: 1;
    }

    .stageFrame {
      fill: none;
      stroke: rgba(255, 255, 255, .08);
      stroke-width: 1;
    }

    .link {
      fill: url(#linkGrad);
    }

    .joint {
      fill: #0f111a;
      stroke: #3ce8f2;
      stroke-width: 2;
    }

    .ee {
      fill: #0f111a;
      stroke: #8d8bff;
      stroke-width: 2;
    }

    .gripBase {
      fill: #151a28;
      stroke: #6ea8ff;
      stroke-width: 1.5;
      opacity: .9;
    }

    .jaw,
    .jawFixed {
      stroke: #9cd2ff;
      stroke-width: 1.5;
    }

    .jaw {
      fill: #1b2a55;
    }

    .jawFixed {
      fill: #26376b;
      opacity: .9;
    }

    .pad {
      fill: #13223a;
      stroke: #214a8a;
      stroke-width: 1;
      opacity: .85;
    }

    .cube {
      fill: #2fe3ff;
      stroke: #0bbcd1;
      stroke-width: 2;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
</head>

<body>
  <svg viewBox="0 0 920 580" aria-label="3-DOF robot arm">
    <defs>
      <linearGradient id="linkGrad" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0%" stop-color="#23d5e6" />
        <stop offset="100%" stop-color="#2d3c9a" />
      </linearGradient>
      <clipPath id="stageClip" clipPathUnits="userSpaceOnUse">
        <rect x="20" y="20" width="880" height="540" rx="14" ry="14"></rect>
      </clipPath>
    </defs>

    <rect class="stageFrame" x="20" y="20" width="880" height="540" rx="14" ry="14"></rect>

    <g clip-path="url(#stageClip)">
      <!-- Grid -->
      <g class="grid">
        <g>
          <line x1="80" y1="20" x2="80" y2="560" />
          <line x1="180" y1="20" x2="180" y2="560" />
          <line x1="280" y1="20" x2="280" y2="560" />
          <line x1="380" y1="20" x2="380" y2="560" />
          <line x1="480" y1="20" x2="480" y2="560" />
          <line x1="580" y1="20" x2="580" y2="560" />
          <line x1="680" y1="20" x2="680" y2="560" />
          <line x1="780" y1="20" x2="780" y2="560" />
        </g>
        <g>
          <line x1="20" y1="80" x2="900" y2="80" />
          <line x1="20" y1="160" x2="900" y2="160" />
          <line x1="20" y1="240" x2="900" y2="240" />
          <line x1="20" y1="320" x2="900" y2="320" />
          <line x1="20" y1="400" x2="900" y2="400" />
          <line x1="20" y1="480" x2="900" y2="480" />
        </g>
      </g>

      <!-- Pads (world space) -->
      <!-- pick pad -->
      <rect class="pad" x="465" y="420" width="60" height="12" rx="3"></rect>
      <!-- lift/place pad -->
      <rect class="pad" x="315" y="390" width="60" height="12" rx="3"></rect>

      <!-- Cube (world space) – starts on pick pad, centered -->
      <!-- pad center = x+30; cube is 28x => center offset 14 -->
      <!-- y on top of pad = padY - cubeSize -->
      <rect id="cube" class="cube" x="481" y="392" width="28" height="28" rx="3"></rect>

      <!-- ROBOT -->
      <g id="robot" transform="translate(240,380) scale(0.95)">
        <rect x="-56" y="18" width="112" height="22" rx="6" fill="#1b2233"></rect>
        <circle cx="0" cy="0" r="14" class="joint"></circle>

        <!-- Joint 1 -->
        <g id="j1" transform="rotate(0)">
          <rect x="0" y="-12" width="180" height="24" rx="12" class="link"></rect>
          <circle cx="0" cy="0" r="10" class="joint"></circle>

          <!-- end of L1 -->
          <g transform="translate(180,0)">
            <!-- Joint 2 -->
            <g id="j2" transform="rotate(0)">
              <rect x="0" y="-10" width="140" height="20" rx="10" class="link"></rect>
              <circle cx="0" cy="0" r="9" class="joint"></circle>

              <!-- end of L2 -->
              <g transform="translate(140,0)">
                <!-- Joint 3 (wrist) -->
                <g id="j3" transform="rotate(0)">
                  <rect x="0" y="-9" width="110" height="18" rx="9" class="link"></rect>
                  <circle cx="0" cy="0" r="8" class="joint"></circle>

                  <!-- End-effector (parallel gripper rotated 90°) -->
                  <g id="ee" transform="translate(110,0)">
                    <circle cx="0" cy="0" r="9" class="ee"></circle>

                    <g id="eeInner" transform="translate(30,0)">
                      <g id="j3Inner" transform="rotate(90)">
                        <!-- gripper body -->
                        <rect class="gripBase" x="-14" y="20" width="28" height="24" rx="4"></rect>

                        <!-- fixed bar -->
                        <g id="jawFixed" transform="translate(0,18)">
                          <rect class="jawFixed" x="-20" y="-3" width="40" height="6" rx="2"></rect>
                        </g>

                        <!-- anchor used to attach payload so it follows the EE exactly -->
                        <g id="payloadAnchor"></g>

                        <!-- moving jaws (I  I) -->
                        <g id="jawL" transform="translate(-14,0)">
                          <rect class="jaw" x="-3" y="-20" width="6" height="40" rx="2"></rect>
                        </g>
                        <g id="jawR" transform="translate(14,0)">
                          <rect class="jaw" x="-3" y="-20" width="6" height="40" rx="2"></rect>
                        </g>
                      </g>
                    </g>
                  </g>
                  <!-- /EE -->
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
    </g>
  </svg>

  <script>
    const ease = 'easeInOutCubic';

    // —— Elements
    const j1 = document.querySelector('#j1');
    const j2 = document.querySelector('#j2');
    const j3 = document.querySelector('#j3');          // wrist (unique)
    const jawL = document.querySelector('#jawL');
    const jawR = document.querySelector('#jawR');
    const cube = document.querySelector('#cube');
    const stage = document.querySelector('g[clip-path]');   // world layer
    const anchor = document.querySelector('#payloadAnchor'); // child of gripper

    // —— Geometry (keep in sync with your pads / cube)
    const padPick = { x: 465, y: 420, w: 60, h: 12 };
    const padLift = { x: 315, y: 390, w: 60, h: 12 };
    const cubeSize = 28;

    const pickXY = { x: padPick.x + padPick.w / 2 - cubeSize / 2, y: padPick.y - cubeSize };
    const placeXY = { x: padLift.x + padLift.w / 2 - cubeSize / 2, y: padLift.y - cubeSize };

    // —— Poses (deg)
    const home = [-60, 20, 90];
    const pick = [-45, 45, 90];
    const lift = [-100, 100, 90];  // "place" pose
    const finish = [-60, 20, 90];

    // —— Gripper gaps
    const OPEN = 22;
    const CLOSED = 18;

    // —— Helpers
    function resetState() {
      // Kill any running tweens to avoid fighting values
      anime.remove([j1, j2, j3, jawL, jawR, cube]);

      // Make sure cube lives in world, not inside gripper
      if (cube.parentNode !== stage) stage.appendChild(cube);

      // Put cube back on pick pad
      cube.setAttribute('x', pickXY.x);
      cube.setAttribute('y', pickXY.y);

      // Reset joints + jaws instantly
      anime.set(j1, { rotate: home[0] });
      anime.set(j2, { rotate: home[1] });
      anime.set(j3, { rotate: home[2] });
      anime.set(jawL, { translateX: -OPEN });
      anime.set(jawR, { translateX: OPEN });
    }

    function attachCube() {
      // Center cube between jaws in gripper-local coords
      if (cube.parentNode !== anchor) {
        cube.setAttribute('x', -cubeSize / 2);
        cube.setAttribute('y', -cubeSize );
        anchor.appendChild(cube);
      }
    }

    function detachCubeAtPlace() {
      if (cube.parentNode === anchor) {
        stage.appendChild(cube);
        cube.setAttribute('x', placeXY.x);
        cube.setAttribute('y', placeXY.y);
      }
    }

    // —— One full cycle (recreated every time for a clean loop)
    function startCycle() {
      resetState();

      const tMove = 1100, tGrip = 450, tLift = 800, tHome = 1100;

      const tl = anime.timeline({
        autoplay: true,
        loop: false,            // we loop manually via complete callback
        easing: ease,
        complete: startCycle    // run again when the cycle ends
      });

      // 1) Move to PICK (parallel)
      tl.add({ targets: j1, rotate: pick[0], duration: tMove }, 0)
        .add({ targets: j2, rotate: pick[1], duration: tMove }, 0)
        .add({ targets: j3, rotate: pick[2], duration: tMove }, 0)
        .add({ duration: 150 });

      // 2) CLOSE jaws, then ATTACH cube (strict order)
      tl.add({ targets: jawL, translateX: -CLOSED, duration: tGrip })
        .add({ targets: jawR, translateX: CLOSED, duration: tGrip }, `-=${tGrip}`)
        .add({ duration: 1, begin: attachCube })
        .add({ duration: 150 });

      // 3) Carry to LIFT pose (cube follows because it's parented)
      tl.add({ targets: j1, rotate: lift[0], duration: tLift })
        .add({ targets: j2, rotate: lift[1], duration: tLift }, `-=${tLift}`)
        .add({ targets: j3, rotate: lift[2], duration: tLift }, `-=${tLift}`)
        .add({ duration: 150 });

      // 4) OPEN jaws, then DETACH cube at the lift pad
      tl.add({ targets: jawL, translateX: -OPEN, duration: tGrip })
        .add({ targets: jawR, translateX: OPEN, duration: tGrip }, `-=${tGrip}`)
        .add({ duration: 1, begin: detachCubeAtPlace })
        .add({ duration: 200 });

      // 5) Return HOME (parallel)
      tl.add({ targets: j1, rotate: finish[0], duration: tHome })
        .add({ targets: j2, rotate: finish[1], duration: tHome }, `-=${tHome}`)
        .add({ targets: j3, rotate: finish[2], duration: tHome }, `-=${tHome}`)
        .add({ duration: 3000 });
    }

    // Kick off
    startCycle();
  </script>
</body>

</html>